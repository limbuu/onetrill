steps:
- name: gcr.io/kaniko-project/executor:latest
  id: 'Build1'
  args: ['--destination=$_IMAGE1_NAME:$COMMIT_SHA','--cache=true']
  timeout: 500s
- name: gcr.io/kaniko-project/executor:latest
  id: 'Build2'
  args: ['--destination=$_IMAGE2_NAME:$COMMIT_SHA','--cache=true', '--dockerfile=./flask/Dockerfile']
  timeout: 500s
  waitFor: ['Build1']
substitutions:
  _IMAGE1_NAME: gcr.io/fuse-ai/built-with-kaniko-image1
  _IMAGE2_NAME: gcr.io/fuse-ai/built-with-kaniko-image2
  _IMAGE1_VERSION: v7.0.0 #Change these for prod 
  _IMAGE2_VERSION: v8.0.0
  _K8S_APP_NAME: one-trill
options:
  substitution_option: 'ALLOW_LOOSE'
timeout: 1000s
tags: [$COMMIT_SHA,$_K8S_APP_NAME,$_K8S_APP_ENVIRONMENT]
logsBucket: 'gs://codehub-cloudbuild-logs'